Index: libraries/models/Panier.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?php\r\n\r\nnamespace Models;\r\n\r\nclass Panier extends Models\r\n{\r\n\r\n    protected $pdo;\r\n\r\n    public function __construct()\r\n    {\r\n        parent::__construct();\r\n\r\n        if (!isset($_SESSION)) {\r\n            session_start();\r\n        }\r\n        if (!isset($_SESSION['panier'])) {\r\n            $_SESSION['panier'] = array();\r\n        }\r\n    }\r\n\r\n    public function add($Produits_id, $taille, $quantity, $prix)\r\n    {\r\n        // echo \"ici var_dump dans fonction add\";\r\n        // echo \"<pre>\";\r\n        // var_dump($Produits_id);\r\n        // echo \"</pre>\";\r\n        // echo \"<pre>\";\r\n        // var_dump($_SESSION['panier']);\r\n        // echo \"</pre>\";\r\n\r\n        if ($_SESSION['panier'] == null) {\r\n            // echo \"ici premier if\";\r\n            $_SESSION['panier'][$Produits_id] = [];\r\n            $_SESSION['panier'][$Produits_id]['taille'] = $taille;\r\n            $_SESSION['panier'][$Produits_id]['quantity'] = $quantity;\r\n            $_SESSION['panier'][$Produits_id]['prix'] = $prix;\r\n\r\n        } else {\r\n            foreach (array_keys($_SESSION['panier']) as $id) {\r\n                // echo \"ici foreach\";\r\n                if ($id == $Produits_id) {\r\n                    $quantity = $_SESSION['panier'][$Produits_id]['quantity'] + $quantity;\r\n                    $_SESSION['panier'][$Produits_id]['quantity'] = $quantity;\r\n                    echo \"ici quantité additionné\";\r\n                    var_dump($quantity);\r\n                    break;\r\n                }\r\n            }if ($_SESSION['panier'] != $Produits_id) {\r\n                $_SESSION['panier'][$Produits_id] = [];\r\n                $_SESSION['panier'][$Produits_id]['taille'] = $taille;\r\n                $_SESSION['panier'][$Produits_id]['quantity'] = $quantity;\r\n                $_SESSION['panier'][$Produits_id]['prix'] = $prix;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        // if ($_SESSION['panier'] == null) {\r\n        //     echo \"ici premier if\";\r\n        //     $_SESSION['panier'][$Produits_id] = [];\r\n        //     $_SESSION['panier'][$Produits_id]['taille'] = $taille;\r\n        //     $_SESSION['panier'][$Produits_id]['quantity'] = $quantity;\r\n        //     $_SESSION['panier'][$Produits_id]['prix'] = $prix;\r\n\r\n        // } else {\r\n        //     foreach (array_keys($_SESSION['panier']) as $id) {\r\n        //         echo \"ici foreach\";\r\n        //         if ($id == $Produits_id) {\r\n        //             echo \"ici if dans foreach\";\r\n        //             echo \"<pre>\";\r\n        //             var_dump($_SESSION['panier']);\r\n        //             echo \"</pre>\";\r\n        //             echo \"<pre>\";\r\n        //             var_dump($quantity);\r\n        //             echo \"</pre>\";\r\n        //             echo \"ici id\";\r\n        //             echo \"<pre>\";\r\n        //             var_dump($id);\r\n        //             echo \"</pre>\";\r\n        //             $_SESSION['panier']['quantity'] = ($_SESSION['panier']['quantity'] + $quantity);\r\n        //             break;\r\n        //         }\r\n        //     }\r\n\r\n        // }\r\n    }\r\n\r\n    // public function montantTotal()\r\n    // {\r\n    //     $total = 0;\r\n    //     for ($i = 1; $i <pre count($_SESSION['panier']); $i++) {\r\n    //         $total += $_SESSION['panier'][$i]['quantity'] * $_SESSION['panier'][$i]['prix'];\r\n    //     }\r\n    //     return round($total, 2);\r\n    // }\r\n\r\n    public function displaypanier()\r\n    {\r\n\r\n        $ids = array_keys($_SESSION['panier']);\r\n\r\n        if (empty($ids)) {\r\n            return $panier = [];\r\n        } else {\r\n            $sql = 'SELECT `product_id`, product_type_description, `product_name`, `product_description`, `other_product_details`, product_image_1, product_image_2 FROM `products` NATURAL JOIN ref_product_types NATURAL JOIN products_image WHERE product_id IN (' . implode(',', $ids) . ')';\r\n\r\n            $query = $this->pdo->prepare($sql);\r\n\r\n            $query->execute();\r\n\r\n            $panier = $query->fetchall();\r\n\r\n            return $panier;\r\n        }\r\n\r\n        // $sql = 'SELECT products.product_id, product_type_id, product_name, product_description, other_product_details,\r\n        // stock.price, products_image.product_image_1, products_image.product_image_2\r\n        // FROM stock INNER JOIN products_image ON products_image.product_id = products.product_id INNER JOIN products ON stock.product_id = products.product_id WHERE products.product_id IN (' . implode(',', $ids) . ')';\r\n\r\n        // $panier = $this->pdo->query($sql)->fetchall();\r\n\r\n        // return $panier;\r\n\r\n    }\r\n\r\n    public function del($Produits_id)\r\n    {\r\n        unset($_SESSION['panier'][$Produits_id]);\r\n    }\r\n\r\n    public function displayCommand() {\r\n        $sql = \"SELECT \"\r\n    }\r\n\r\n    public function insertCommand()\r\n    {\r\n        $requete = \"INSERT INTO orders\r\n                (customer_id,\r\n                 order_status_code,\r\n                 date_order_placed,\r\n                 order_details)\r\n                VALUES\r\n                (:customer_id,\r\n                 :order_status_code,\r\n                 :date_order_placed,\r\n                 :order_details)\";\r\n\r\n        $requete = $this->pdo->prepare($requete);\r\n\r\n        $order_status_code = 1;\r\n        date_default_timezone_set('Europe/Paris');\r\n        @$date = date(\"Y-m-d H:i:s\");\r\n        $order_details = $this->montantTotal();\r\n\r\n        $requete->bindParam(':customer_id', $_SESSION['customer']['customer_id']);\r\n        $requete->bindParam(':order_status_code', $order_status_code);\r\n        $requete->bindParam(':date_order_placed', $date);\r\n        $requete->bindParam(':order_details', $order_details);\r\n\r\n        $requete->execute();\r\n\r\n        $id_commande = $this->pdo->lastInsertId();\r\n        echo \"ici print\";\r\n        print $this->pdo->lastInsertId();\r\n\r\n        $panier = $this->displaypanier();\r\n\r\n        // echo \"<pre>\";\r\n        // var_dump($panier);\r\n        // echo \"</pre>\";\r\n\r\n        foreach ($panier as $panier) {\r\n\r\n            echo \"<pre>\";\r\n            var_dump($panier);\r\n            echo \"</pre>\";\r\n\r\n            $requete = \"INSERT INTO order_items\r\n                (product_id,\r\n                 order_id,\r\n                 order_item_status_code,\r\n                 order_item_quantity,\r\n                 order_item_price,\r\n                 other_order_item_details)\r\n                VALUES\r\n                (:product_id,\r\n                 :order_id,\r\n                 :order_item_status_code,\r\n                 :order_item_quantity,\r\n                 :order_item_price,\r\n                 :other_order_item_details)\";\r\n\r\n            $requete = $this->pdo->prepare($requete);\r\n\r\n            $product_id = $panier['product_id'];\r\n            $product_quantity = $_SESSION['panier'][$panier['product_id']]['quantity'];\r\n            $product_price = $_SESSION['panier'][$panier['product_id']]['prix'];\r\n            $product_taille = $_SESSION['panier'][$panier['product_id']]['taille'];\r\n\r\n            $requete->bindParam(':product_id', $product_id);\r\n            $requete->bindParam(':order_id', $id_commande);\r\n            $requete->bindParam(':order_item_status_code', $order_status_code);\r\n            $requete->bindParam(':order_item_quantity', $product_quantity);\r\n            $requete->bindParam(':order_item_price', $product_price);\r\n            $requete->bindParam(':other_order_item_details', $product_taille);\r\n\r\n            $requete->execute();\r\n\r\n        }\r\n        unset($_SESSION['panier']);\r\n        die('Votre Commande à bien été ajouté');\r\n\r\n        // for ($i = 0; $i < count($_SESSION['panier']['id_produit']); $i++) {\r\n        //     executeRequete(\"INSERT INTO details_commande (id_commande, id_produit, quantite, prix) VALUES ($id_commande, \" . $_SESSION['panier']['id_produit'][$i] . \",\" . $_SESSION['panier']['quantite'][$i] . \",\" . $_SESSION['panier']['prix'][$i] . \")\");\r\n        // }\r\n\r\n    }\r\n\r\n    public function montantTotal()\r\n    {\r\n        $total = 0;\r\n        $panier = $this->displaypanier();\r\n        foreach ($panier as $panier) {\r\n            $total += $_SESSION['panier'][$panier[\"product_id\"]]['quantity'] * $_SESSION['panier'][$panier[\"product_id\"]]['prix'];\r\n        }\r\n        return round($total, 2);\r\n    }\r\n}\r\n\r\n// cecile.lemedo@logirem.fr quittance + contrat\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/libraries/models/Panier.php b/libraries/models/Panier.php
--- a/libraries/models/Panier.php	(revision f9ed6ea8724ab3d8c81cc729ee269271a3d9f46a)
+++ b/libraries/models/Panier.php	(date 1617876223844)
@@ -130,7 +130,7 @@
     }
 
     public function displayCommand() {
-        $sql = "SELECT "
+        $sql = "SELECT ";
     }
 
     public function insertCommand()
@@ -161,8 +161,8 @@
         $requete->execute();
 
         $id_commande = $this->pdo->lastInsertId();
-        echo "ici print";
-        print $this->pdo->lastInsertId();
+        //echo "ici print";
+        //print $this->pdo->lastInsertId();
 
         $panier = $this->displaypanier();
 
@@ -173,7 +173,7 @@
         foreach ($panier as $panier) {
 
             echo "<pre>";
-            var_dump($panier);
+            //var_dump($panier);
             echo "</pre>";
 
             $requete = "INSERT INTO order_items
@@ -209,7 +209,7 @@
 
         }
         unset($_SESSION['panier']);
-        die('Votre Commande à bien été ajouté');
+        die('Votre Commande à bien été prise en compte. Merci :)');
 
         // for ($i = 0; $i < count($_SESSION['panier']['id_produit']); $i++) {
         //     executeRequete("INSERT INTO details_commande (id_commande, id_produit, quantite, prix) VALUES ($id_commande, " . $_SESSION['panier']['id_produit'][$i] . "," . $_SESSION['panier']['quantite'][$i] . "," . $_SESSION['panier']['prix'][$i] . ")");
